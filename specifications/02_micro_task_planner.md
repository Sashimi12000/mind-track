# **MT-1. マイクロタスクプランナー機能 仕様詳細** {#MT-1}

## **MT-1.1. 目的** {#MT-1.1}

「やらなきゃ」を心理的抵抗の少ない「超スモールステップ」に分解・設定し、行動開始のハードルを極限まで下げる。

## **MT-1.2. UI/UX** {#MT-1.2}

### **MT-1.2.1. 表示場所と形式** {#MT-1.2.1}

*   **表示場所**: メイン画面（ダッシュボード）の中央部
*   **表示形式**: カード形式のタスクリスト
*   **セクション構成**:
    *   セクションタイトル: 「今日のマイクロタスク」
    *   タスクリスト（縦方向配置）
    *   「＋タスクを追加」ボタン（リスト下部）

### **MT-1.2.2. タスク表示・操作UI** {#MT-1.2.2}

1.  **タスクアイテム**:
    *   **レイアウト**: 横方向の配置（左: チェックボックス、中央: タスク内容、右: 操作ボタン）
    *   **UI**: daisyUIのcard/listコンポーネントを活用
    *   **完了状態**: 完了したタスクは取り消し線とグレーアウト表示
    *   **ホバー効果**: マウスオーバー時に背景色変更やシャドウ表示

2.  **チェックボックス**:
    *   **UI**: `daisyui-checkbox` を使用
    *   **動作**: クリックで完了/未完了をトグル
    *   **視覚フィードバック**: チェック時にアニメーション（フェードイン・スケール）

3.  **タスク内容表示**:
    *   **表示**: タスクの説明文を表示
    *   **文字数制限**: 長いテキストの場合は省略表示（...）
    *   **改行処理**: 複数行の場合は適切に表示

4.  **操作ボタン**:
    *   **編集ボタン**: 鉛筆アイコン、クリックで編集モード切り替え
    *   **削除ボタン**: ゴミ箱アイコン、クリックで削除確認
    *   **メモボタン**: 📝アイコン、メモがある場合のみ表示

### **MT-1.2.3. タスク追加・編集UI** {#MT-1.2.3}

1.  **追加モード**:
    *   **トリガー**: 「＋タスクを追加」ボタンクリック
    *   **UI**: インライン入力フィールドが表示される
    *   **入力フィールド**: `daisyui-input` を使用
    *   **プレースホルダー**: 「例: 5分だけ部屋を片付ける」
    *   **アクションボタン**: 「追加」（プライマリ）、「キャンセル」（セカンダリ）

2.  **編集モード**:
    *   **トリガー**: 編集ボタンクリック
    *   **UI**: 該当タスクの表示がインライン編集フィールドに切り替わる
    *   **プリセット**: 既存のタスク内容が入力フィールドに設定済み
    *   **アクションボタン**: 「更新」（プライマリ）、「キャンセル」（セカンダリ）

3.  **メモ編集**:
    *   **トリガー**: メモボタンクリック
    *   **UI**: モーダル形式で表示
    *   **入力**: `daisyui-textarea` で複数行入力可能
    *   **プレースホルダー**: 「タスクの詳細メモを入力...」

### **MT-1.2.4. ドラッグ&ドロップ（順序変更）** {#MT-1.2.4}

*   **機能**: タスクの表示順序をドラッグ&ドロップで変更可能
*   **視覚フィードバック**: ドラッグ中の半透明表示、ドロップ可能位置のハイライト
*   **制約**: 完了済みタスクはドラッグ不可

### **MT-1.2.5. フィードバック** {#MT-1.2.5}

*   **完了時**: 達成ログ＆承認フィードバック機能と連携
*   **操作完了時**: 追加・更新・削除時にトースト表示
*   **エラー時**: インライン/モーダルでエラーメッセージ表示

## **MT-1.3. データ構造 (SQLite: micro_tasks テーブル)** {#MT-1.3}

| カラム名               | 型      | 制約                               | 説明                                     |
| ---------------------- | ------- | ---------------------------------- | ---------------------------------------- |
| `local_id`             | INTEGER | PRIMARY KEY AUTOINCREMENT          | ローカルID                               |
| `uuid`                 | TEXT    | NOT NULL, UNIQUE                   | グローバル一意ID (UUID v4)               |
| `daily_checkin_uuid`   | TEXT    | NULL許容                           | 紐づくデイリーチェックインのUUID (任意)  |
| `task_description`     | TEXT    | NOT NULL, max 200 chars, Not Empty| タスク内容                               |
| `task_memo`            | TEXT    | NULL許容, max 1000 chars           | タスクのメモ                             |
| `is_completed`         | INTEGER | NOT NULL DEFAULT 0                 | 完了フラグ (0:未完了, 1:完了)            |
| `completed_at`         | TEXT    | NULL許容                           | 完了日時 (ISO 8601 UTC)                  |
| `created_at`           | TEXT    | NOT NULL                           | 作成日時 (ISO 8601 UTC)                  |
| `updated_at`           | TEXT    | NOT NULL                           | 更新日時 (ISO 8601 UTC)                  |
| `deleted_at`           | TEXT    | NULL許容                           | 論理削除日時 (ISO 8601 UTC)              |
| `sort_order`           | INTEGER | NOT NULL DEFAULT 0                 | 表示順序 (0からの連番)                   |
| `date`                 | TEXT    | NOT NULL, `YYYY-MM-DD`形式         | タスクが作成された日付                   |

**検討事項・変更点:**
*   `daily_checkin_uuid`: デイリーチェックインと必須連携にするか任意にするか。任意の場合、直接タスク追加も可能。
*   `date`: タスクがどの日に作成されたかを管理するため追加。日付別のタスク表示に使用。
*   `sort_order`: ユーザーによるドラッグ&ドロップでの順序変更に対応。

## **MT-1.4. バリデーションルール** {#MT-1.4}

### **MT-1.4.1. フロントエンド (SvelteKit)** {#MT-1.4.1}

*   **タスク内容**: 必須入力、最大200文字、空白のみは不可
*   **タスクメモ**: 任意、最大1000文字
*   **追加制限**: 1日あたりの最大タスク数（例: 20個）
*   **リアルタイムバリデーション**: 入力中の文字数カウント表示

### **MT-1.4.2. バックエンド (Rust)** {#MT-1.4.2}

*   **タスク内容**: 文字数制限、空文字・空白チェック
*   **日付**: `YYYY-MM-DD` 形式、過去〜今日の範囲
*   **sort_order**: 非負整数、同一日付内での重複チェック
*   **UUID**: 形式チェック、一意性制約

## **MT-1.5. バックエンド処理 (Rust - Tauri Commands)** {#MT-1.5}

### **MT-1.5.1. `create_micro_task` コマンド** {#MT-1.5.1}

*   **入力ペイロード**:
    ```typescript
    interface CreateMicroTaskPayload {
      taskDescription: string;
      taskMemo?: string;
      dailyCheckinUuid?: string;
      date: string; // YYYY-MM-DD
    }
    ```
*   **処理フロー**:
    1. ペイロードバリデーション
    2. UUID v4生成
    3. sort_orderの自動採番（同日最大値+1）
    4. データベース挿入
    5. 成功時: 作成されたタスクデータを返却

### **MT-1.5.2. `update_micro_task` コマンド** {#MT-1.5.2}

*   **入力ペイロード**:
    ```typescript
    interface UpdateMicroTaskPayload {
      uuid: string;
      taskDescription?: string;
      taskMemo?: string;
    }
    ```

### **MT-1.5.3. `complete_micro_task` コマンド** {#MT-1.5.3}

*   **入力**: `{ uuid: string, isCompleted: boolean }`
*   **処理**: 完了状態更新、completed_at設定
*   **連携**: 達成ログ機能への通知

### **MT-1.5.4. `delete_micro_task` コマンド** {#MT-1.5.4}

*   **入力**: `{ uuid: string }`
*   **処理**: 論理削除（deleted_at設定）

### **MT-1.5.5. `get_micro_tasks_by_date` コマンド** {#MT-1.5.5}

*   **入力**: `{ date: string }` (YYYY-MM-DD)
*   **出力**: 指定日のタスク一覧（sort_order順）

### **MT-1.5.6. `reorder_micro_tasks` コマンド** {#MT-1.5.6}

*   **入力**: `{ taskUuids: string[] }` (新しい順序でのUUID配列)
*   **処理**: sort_orderの一括更新

## **MT-1.6. フロントエンド処理 (SvelteKit)** {#MT-1.6}

### **MT-1.6.1. 状態管理** {#MT-1.6.1}

*   **Svelteストア**: 
    *   `microTasksStore`: 現在表示中のタスクリスト
    *   `selectedDateStore`: 表示対象日付
    *   `isEditingStore`: 編集モード状態管理

### **MT-1.6.2. データ取得・更新** {#MT-1.6.2}

*   **初期読み込み**: ページ表示時に`get_micro_tasks_by_date`で今日のタスク取得
*   **リアルタイム更新**: CRUD操作後にストア更新
*   **エラーハンドリング**: 操作失敗時のロールバック処理

### **MT-1.6.3. ドラッグ&ドロップ実装** {#MT-1.6.3}

*   **ライブラリ**: svelte-dndまたはsortable.jsの活用検討
*   **制約**: 完了済みタスクの移動制限
*   **保存**: 順序変更後に`reorder_micro_tasks`コマンド実行

## **MT-1.7. 不明点・検討事項リスト** {#MT-1.7}

### **MT-1.7.1. UI/UX 関連** {#MT-1.7.1}
*   **完了済みタスクの表示**: 同一画面に表示するか、別セクション/画面にするか
*   **タスク数制限**: 1日あたりの最大タスク数の設定値
*   **インライン編集**: 編集モード時のエスケープ操作（ESC、外部クリック）の動作
*   **ドラッグ&ドロップ**: モバイル端末での操作方法（長押し、専用ハンドル）
*   **メモ表示**: タスクリストでのメモ存在の視覚的表示方法
*   **アニメーション**: タスク追加・削除時のトランジション効果
*   **空状態**: タスクが0件の場合の表示内容とCTA
*   **検索・フィルタ**: 大量タスクに対する検索機能の要否
*   **キーボードショートカット**: 追加（Ctrl+N）、完了切り替え（Space）等

### **MT-1.7.2. データ・ロジック関連** {#MT-1.7.2}
*   **デイリーチェックイン連携**: 必須連携か任意か、連携しない場合の扱い
*   **タスクの繰り越し**: 未完了タスクの翌日への持ち越し機能
*   **タスクテンプレート**: よく使うタスクのテンプレート保存機能
*   **カテゴリ分類**: タスクのカテゴリやタグ機能の要否
*   **定期タスク**: 日次・週次などの繰り返しタスクサポート
*   **時間管理**: タスクの予想時間、実行時間の記録
*   **優先度**: タスクの優先度設定機能
*   **サブタスク**: 大きなタスクの分解機能
*   **アーカイブ**: 完了済みタスクの長期保存とアクセス方法

### **MT-1.7.3. バリデーション・エラー処理関連** {#MT-1.7.3}
*   **同時編集制御**: 複数インスタンスでの同じタスクの編集競合
*   **オフライン対応**: ネットワーク断絶時の操作キューイング
*   **データ復旧**: 操作失敗時のUNDO機能の要否
*   **重複チェック**: 同じ内容のタスクの重複登録防止

### **MT-1.7.4. パフォーマンス・技術関連** {#MT-1.7.4}
*   **仮想スクロール**: 大量タスクでの表示パフォーマンス
*   **差分更新**: リスト更新時の効率的な DOM 操作
*   **キャッシュ戦略**: タスクデータのローカルキャッシュ
*   **バッチ処理**: 複数タスクの一括操作（一括削除、一括完了）

### **MT-1.7.5. セキュリティ・プライバシー関連** {#MT-1.7.5}
*   **データ暗号化**: 機密性の高いタスク内容の暗号化
*   **アクセス制御**: タスクデータへのアクセス権限管理
*   **監査ログ**: タスク操作の履歴追跡

### **MT-1.7.6. 運用・保守関連** {#MT-1.7.6}
*   **データクリーンアップ**: 古い完了済みタスクの自動削除
*   **パフォーマンス監視**: タスク操作のレスポンス時間測定
*   **使用統計**: タスクの作成・完了パターンの分析
*   **インポート・エクスポート**: 他のタスク管理ツールとの連携

---
